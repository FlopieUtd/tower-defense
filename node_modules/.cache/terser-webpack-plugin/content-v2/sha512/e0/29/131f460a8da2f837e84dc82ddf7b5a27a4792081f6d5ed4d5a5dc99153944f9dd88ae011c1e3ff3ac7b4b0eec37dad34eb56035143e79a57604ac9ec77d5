{"code":"!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=6)}([function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(1),o=n(2);t.CANVAS=document.querySelector(\"canvas\"),t.CTX=t.CANVAS.getContext(\"2d\"),t.SPAWN_LOCATION=o.getUniquePosition(i.level01.map,2),t.HEADQUARTERS=o.getUniquePosition(i.level01.map,3),t.TILE_SIZE=50,t.STARTING_MONEY=200,t.STARTING_HQ_HEALTH=20,t.WAVE_NUM_DIV=document.querySelector(\".wave-num\"),t.COIN_NUM_DIV=document.querySelector(\".coin-num\"),t.FAST_FORWARD_DIV=document.querySelector(\".fast-forward\"),t.BOTTOM_BAR_DIV=document.querySelector(\".bottom-bar\")},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0),o=n(3);t.level01={map:[[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0],[0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],waves:[{amount:20,type:\"normal\"},{amount:20,type:\"normal\"},{amount:20,type:\"normal\"},{amount:20,type:\"normal\"},{amount:20,type:\"normal\"},{amount:20,type:\"normal\"}]},t.renderMap=function(e){i.CTX.fillStyle=\"black\",i.CTX.fillRect(0,0,e[0].length*i.TILE_SIZE,e.length*i.TILE_SIZE),e.forEach((function(e,t){e.forEach((function(e,n){e>0&&e<4&&(i.CTX.fillStyle=\"#444\",i.CTX.fillRect(n*i.TILE_SIZE,t*i.TILE_SIZE,i.TILE_SIZE,i.TILE_SIZE))}))}))},t.renderBuildings=function(e){e.forEach((function(e,t){e.forEach((function(e,n){2===e&&(i.CTX.fillStyle=\"#222\",i.CTX.fillRect(n*i.TILE_SIZE,t*i.TILE_SIZE,i.TILE_SIZE,i.TILE_SIZE),i.CTX.font=\"20px monospace\",i.CTX.fillStyle=\"white\",i.CTX.textAlign=\"center\",i.CTX.fillText(\"S\",n*i.TILE_SIZE+.5*i.TILE_SIZE,t*i.TILE_SIZE+.6*i.TILE_SIZE)),3===e&&(i.CTX.fillStyle=\"#222\",i.CTX.fillRect(n*i.TILE_SIZE,t*i.TILE_SIZE,i.TILE_SIZE,i.TILE_SIZE),i.CTX.font=\"20px monospace\",i.CTX.fillStyle=\"white\",i.CTX.textAlign=\"center\",i.CTX.fillText(o.hqHealth.value.toString(),n*i.TILE_SIZE+.5*i.TILE_SIZE,t*i.TILE_SIZE+.6*i.TILE_SIZE))}))}))}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.getUniquePosition=function(e,t){var n,i;return e.forEach((function(e,o){e.includes(t)&&(i=o,n=e.indexOf(t))})),{x:n,y:i}},t.getValueAtPosition=function(e,t){var n=e.x,i=e.y;return t[i]?t[i][n]:null},t.arePositionsEqual=function(e,t){return Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((function(n){return e[n]===t[n]}))},t.getAdjacentPositions=function(e,n){return[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter((function(e){return t.getValueAtPosition(e,n)>0&&t.getValueAtPosition(e,n)<4}))},t.positionToId=function(e){return e.x+1e3*e.y},t.breadthFirstSearch=function(e){var n=e.map,i=e.start,o=e.end,r=new Set,l=[];l.push({position:i,path:[]});for(var a=function(){var e=l.shift(),i=e.position,a=e.path;if(t.arePositionsEqual(i,o))return{value:a};r.has(t.positionToId(i))||(r.add(t.positionToId(i)),t.getAdjacentPositions(i,n).forEach((function(e){l.push({position:e,path:a.concat([e])})})))};l.length;){var u=a();if(\"object\"==typeof u)return u.value}return[]},t.areColliding=function(e,t){var n=e.position.x-t.position.x,i=e.position.y-t.position.y;return Math.sqrt(n*n+i*i)<e.radius+t.radius}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0),o=n(1);t.id={value:0,get:function(){return this.value++}},t.money={value:null,set:function(e){this.value=e,this.updateUI()},increaseBy:function(e){this.value+=e,this.updateUI()},decreaseBy:function(e){this.value-=e,this.updateUI()},updateUI:function(){i.COIN_NUM_DIV.innerHTML=this.value.toString()}},t.hqHealth={value:null,set:function(e){this.value=e},decrease:function(){this.value--}},t.waves={value:null,set:function(e){this.value=e,this.updateUI()},increase:function(){this.value++,this.updateUI()},updateUI:function(){i.WAVE_NUM_DIV.innerHTML=(this.value+1).toString()+\" / \"+o.level01.waves.length}},t.construction={displayPreview:!1,position:null,blueprint:null,showPreview:function(){this.displayPreview=!0},hidePreview:function(){this.displayPreview=!1},setPosition:function(e){this.position=e},setBlueprint:function(e){this.blueprint=e}},t.mouse={position:null,setPosition:function(e){this.position=e}}},function(e,t,n){\"use strict\";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,\"__esModule\",{value:!0});var o=n(0),r=n(7),l=n(1),a=n(3),u=n(5),s=n(8),c=n(2),f=0,v=0,E=!1,d=!1,I=!1;t.finishLevel=function(){console.log(\"level won!\")};var p=function(){++f%30==0&&l.level01.waves[a.waves.value]&&l.level01.waves[a.waves.value].amount&&(l.level01.waves[a.waves.value].amount--,r.activeEnemies.push(i(i({},r.enemyBlueprints.filter((function(e){return e.type===l.level01.waves[a.waves.value].type}))),{originalHealth:l.level01.waves[a.waves.value].health,health:l.level01.waves[a.waves.value].health,id:a.id.get(),isUnderFire:!1,position:c.getUniquePosition(l.level01.map,2),radius:.05,reward:3,speed:2,intervalInTicks:30,route:c.breadthFirstSearch({end:o.HEADQUARTERS,map:l.level01.map,start:o.SPAWN_LOCATION})}))),l.level01.waves[a.waves.value].amount<1&&++v%1e3==0&&(a.waves.value<l.level01.waves.length-1&&a.waves.increase(),v=0),r.updateEnemies(r.activeEnemies),u.updateTowers(u.towers,r.activeEnemies)},T=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},h=T(),y=0,_=function(){var e=T(),t=I?1/240:1/60;for(y+=Math.min(1,(e-h)/1e3);y>t;)y-=t,p();h=e,l.renderMap(l.level01.map),u.renderTowers(u.towers),r.renderEnemies(r.activeEnemies),u.renderConstructionPreview(),l.renderBuildings(l.level01.map),a.hqHealth.value<=0&&(console.log(\"game over!\"),E=!0),d||E||requestAnimationFrame(_)},m=function(e){var t=e.offsetX,n=e.offsetY,i={x:Math.floor(t/o.TILE_SIZE),y:Math.floor(n/o.TILE_SIZE)};a.mouse.setPosition(i)},S=function(){a.mouse.setPosition(null)},w=function(){var e=a.mouse.position,t=a.construction.blueprint,n=a.construction.displayPreview;if(0===c.getValueAtPosition(e,l.level01.map)&&n&&t){var o=t.cost;a.money.decreaseBy(o),l.level01.map[e.y][e.x]=4,u.towers.push(i(i({},t),{id:a.id.get(),position:e,isFiring:!1})),a.construction.setPosition(null)}},L=function(e){if(\"p\"===e.key&&(d=!d,requestAnimationFrame(_)),\"f\"===e.key&&g(),\"Escape\"===e.key&&a.construction.hidePreview(),isFinite(Number(e.key))){var t=Number(e.key)-1;u.towerBlueprints[t]&&P(u.towerBlueprints[t])}},g=function(){I=!I,o.FAST_FORWARD_DIV.innerHTML=I?\">\":\">>\"},P=function(e){e.cost<=a.money.value&&(a.construction.setBlueprint(e),a.construction.showPreview())};t.startGame=function(){var e;(e=o.CANVAS).width=l.level01.map[0].length*o.TILE_SIZE,e.style.width=l.level01.map[0].length*o.TILE_SIZE+\"px\",e.height=l.level01.map.length*o.TILE_SIZE,e.style.height=l.level01.map.length*o.TILE_SIZE+\"px\",s.initializeUI(),o.CANVAS.addEventListener(\"mousemove\",m),o.CANVAS.addEventListener(\"mouseleave\",S),o.CANVAS.addEventListener(\"click\",w),document.addEventListener(\"keydown\",L),o.FAST_FORWARD_DIV.addEventListener(\"click\",g),u.towerBlueprints.forEach((function(e){document.querySelector(\".tower-slot.\"+e.type).addEventListener(\"click\",(function(){P(e)}))})),a.money.set(o.STARTING_MONEY),a.hqHealth.set(o.STARTING_HQ_HEALTH),a.waves.set(0),requestAnimationFrame(_)}},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0),o=n(1),r=n(3),l=n(2);t.towerBlueprints=[{type:\"turret\",damagePerFrame:1,radius:1.5,cost:100,color:\"blue\"},{type:\"flamethrower\",damagePerFrame:2,radius:1,cost:150,color:\"red\"}],t.updateTowers=function(e,t){e.forEach((function(e){e.isFiring=!1;var n=[];if(t.forEach((function(t){l.areColliding(e,t)&&n.push(t)})),n.sort((function(e,t){return e.id-t.id})),n.length){e.isFiring=!0;var i=e.damagePerFrame,o=n[0];o.isUnderFire=!0,o.health-=i}}))},t.renderTowers=function(e){e.forEach((function(e){var t=e.position,n=e.isFiring,o=t.x,r=t.y;i.CTX.fillStyle=e.color,i.CTX.fillRect(o*i.TILE_SIZE+10,r*i.TILE_SIZE+10,i.TILE_SIZE-20,i.TILE_SIZE-20),n&&(i.CTX.fillStyle=\"white\",i.CTX.beginPath(),i.CTX.arc(o*i.TILE_SIZE+.5*i.TILE_SIZE,r*i.TILE_SIZE+.5*i.TILE_SIZE,5,0,2*Math.PI),i.CTX.fill())}))},t.renderConstructionPreview=function(){var e=r.construction.displayPreview,t=r.construction.blueprint;if(t){var n=t.cost,a=t.color,u=t.radius,s=r.mouse.position,c=r.money.value;e&&s&&0===l.getValueAtPosition(s,o.level01.map)&&n<=c&&(i.CTX.fillStyle=\"rgba(255,255,255,.1)\",i.CTX.beginPath(),i.CTX.arc(s.x*i.TILE_SIZE+.5*i.TILE_SIZE,s.y*i.TILE_SIZE+.5*i.TILE_SIZE,u*i.TILE_SIZE,0,2*Math.PI),i.CTX.fill(),i.CTX.fillStyle=a,i.CTX.fillRect(s.x*i.TILE_SIZE+10,s.y*i.TILE_SIZE+10,i.TILE_SIZE-20,i.TILE_SIZE-20)),n>c&&r.construction.hidePreview()}},t.towers=[]},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),n(4).startGame()},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0),o=n(4),r=n(1),l=n(3),a=n(2);t.move=function(e,t,n){var i=n/100;return e.x<t.x?{x:Number((e.x+=i).toFixed(4)),y:e.y}:e.x>t.x?{x:Number((e.x-=i).toFixed(4)),y:e.y}:e.y<t.y?{x:e.x,y:Number((e.y+=i).toFixed(4))}:e.y>t.y?{x:e.x,y:Number((e.y-=i).toFixed(4))}:void 0},t.updateEnemies=function(e){e.forEach((function(n){var u=n.position,s=n.route,c=n.health,f=n.reward,v=n.speed;if(c<=0&&l.money.increaseBy(f),a.arePositionsEqual(u,i.HEADQUARTERS)&&l.hqHealth.decrease(),a.arePositionsEqual(u,i.HEADQUARTERS)||c<=0)return e.splice(e.indexOf(n),1),l.waves.value===r.level01.waves.length-1&&0===e.length&&o.finishLevel(),null;a.arePositionsEqual(u,s[0])&&s.shift(),n.position=t.move(u,s[0],v),n.isUnderFire=!1}))},t.renderEnemies=function(e){e.forEach((function(e){var t=e.position,n=e.isUnderFire,o=e.health,r=e.originalHealth;i.CTX.fillStyle=n?\"white\":\"red\",i.CTX.beginPath(),i.CTX.arc(t.x*i.TILE_SIZE+.5*i.TILE_SIZE,t.y*i.TILE_SIZE+.5*i.TILE_SIZE,5,0,2*Math.PI),i.CTX.fill(),o/r<1&&(i.CTX.fillStyle=\"black\",i.CTX.fillRect(t.x*i.TILE_SIZE+17.5,t.y*i.TILE_SIZE+35,15,2),i.CTX.fillStyle=\"lime\",i.CTX.fillRect(t.x*i.TILE_SIZE+17.5,t.y*i.TILE_SIZE+35,o/r*15,2))}))},t.enemyBlueprints=[{type:\"normal\",color:\"red\",radius:1.5,originalHealth:100,reward:3,speed:2,intervalInTicks:30}],t.activeEnemies=[]},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(0),o=n(5);t.initializeUI=function(){o.towerBlueprints.forEach((function(e){i.BOTTOM_BAR_DIV.innerHTML+=\"<div class='tower-slot \"+e.type+'\\'><div class=\"preview\" style=\"background: '+e.color+'\"/></div>'}))}}]);","extractedComments":[]}